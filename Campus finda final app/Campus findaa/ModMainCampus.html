<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Find: Offline P2P Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #2a4b8c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        /* Login/Register Styles */
        #authPage {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: -20px;
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 30px 40px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            width: 360px;
            text-align: center;
        }

        .app-title {
            font-size: 2rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            text-align: left;
        }

            .auth-form.hidden {
                display: none;
            }

        .auth-label {
            margin-top: 10px;
            font-weight: 500;
            color: #fff;
        }

        .auth-input, .auth-select {
            margin-top: 5px;
            padding: 10px;
            border: none;
            border-radius: 8px;
            outline: none;
            width: 100%;
            box-sizing: border-box;
        }

        .auth-btn {
            margin-top: 20px;
            padding: 10px;
            border: none;
            background-color: #0d47a1;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

            .auth-btn:hover {
                background-color: #1565c0;
            }

        .forgot-btn {
            margin-top: 10px;
            padding: 8px;
            border: none;
            background-color: transparent;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
            text-decoration: underline;
        }

            .forgot-btn:hover {
                color: #90caf9;
            }

        .form-toggle {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

            .form-toggle button {
                flex: 1;
                padding: 10px;
                border: none;
                background-color: rgba(255,255,255,0.3);
                color: #fff;
                cursor: pointer;
                border-radius: 8px;
                font-weight: bold;
                margin: 0 5px;
            }

                .form-toggle button.active {
                    background-color: #0d47a1;
                }

        .user-specific.hidden {
            display: none;
        }

        /* Main Application Styles */
        #mainPage {
            display: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .map-container {
            flex: 2;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .controls-panel {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.102);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
        }

        .panel-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .campus-map {
            height: 500px;
            background: #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 800 500"><rect width="100%" height="100%" fill="%232c3e50"/><text x="400" y="250" font-family="Arial" font-size="24" fill="%235a79ba" text-anchor="middle">Richfield Campus</text></svg>');
            background-size: cover;
        }

        .floor-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }

        .floor-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

            .floor-btn.active {
                background: #3498db;
                font-weight: bold;
            }

            .floor-btn:hover:not(.active) {
                background: rgba(255, 255, 255, 0.2);
            }

        .device {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            border: 2px solid white;
            transition: all 0.5s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            z-index: 1;
        }

            .device::after {
                content: attr(data-name);
                position: absolute;
                bottom: -30px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.7);
                padding: 4px 10px;
                border-radius: 4px;
                font-size: 12px;
                white-space: nowrap;
                opacity: 0;
                transition: opacity 0.3s;
            }

            .device:hover::after {
                opacity: 1;
            }

        .device-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .device-item {
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .device-item:hover {
                background: rgba(255, 255, 255, 0.2);
            }

            .device-item.active {
                background: rgba(52, 152, 219, 0.3);
                border: 1px solid #3498db;
            }

        .device-info {
            flex: 1;
        }

        .device-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .device-floor {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .device-distance {
            font-weight: bold;
            background: rgba(0, 0, 0, 0.4);
            padding: 5px 10px;
            border-radius: 20px;
            min-width: 70px;
            text-align: center;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 14px 25px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }

            .btn:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: translateY(-2px);
            }

        .btn-primary {
            background: #3498db;
        }

            .btn-primary:hover {
                background: #2980b9;
            }

        .btn-danger {
            background: #e74c3c;
        }

            .btn-danger:hover {
                background: #c0392b;
            }

        .btn-success {
            background: #2ecc71;
        }

            .btn-success:hover {
                background: #27ae60;
            }

        .btn-warning {
            background: #f39c12;
        }

            .btn-warning:hover {
                background: #e67e22;
            }

        .status-bar {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            font-size: 1.1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .signal-strength {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            vertical-align: middle;
        }

        .signal-excellent {
            background: #2ecc71;
            box-shadow: 0 0 10px #2ecc71;
        }

        .signal-good {
            background: #f1c40f;
            box-shadow: 0 0 10px #f1c40f;
        }

        .signal-weak {
            background: #e74c3c;
            box-shadow: 0 0 10px #e74c3c;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .contact-options {
            display: none;
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 100;
            flex-direction: column;
            gap: 10px;
            min-width: 180px;
        }

            .contact-options.active {
                display: flex;
            }

        .contact-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 5px;
        }

        .contact-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .contact-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

            .contact-btn:hover {
                background: rgba(255, 255, 255, 0.2);
            }

        .search-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .search-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

            .search-btn:hover {
                background: rgba(255, 255, 255, 0.2);
            }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Admin Panel Styles */
        .admin-panel {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

            .admin-panel.active {
                display: block;
            }

        .admin-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .admin-form {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: 500;
            }

            .form-group input, .form-group textarea, .form-group select {
                width: 100%;
                padding: 10px;
                border: none;
                border-radius: 8px;
                background: rgba(255, 255, 255, 0.1);
                color: white;
            }

            .form-group textarea {
                height: 100px;
                resize: vertical;
            }

        .notifications-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .notification-item {
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .notification-date {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .notification-content {
            margin-bottom: 10px;
        }

        .notification-actions {
            display: flex;
            gap: 10px;
        }

            .notification-actions .btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

        /* Logout Page Styles */
        .logout-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
        }

        .logout-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            max-width: 500px;
            width: 100%;
        }

        .logout-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #e74c3c;
        }

        .logout-title {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .logout-message {
            font-size: 1.1rem;
            margin-bottom: 30px;
            opacity: 0.9;
            line-height: 1.6;
        }

        .logout-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            h1 {
                font-size: 2rem;
            }

            .campus-map {
                height: 400px;
            }

            .search-buttons {
                grid-template-columns: 1fr;
            }

            .logout-actions {
                flex-direction: column;
            }

            .admin-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Page (Login/Register) -->
    <div id="authPage">
        <div class="auth-container">
            <h1 class="app-title">Campus Finda</h1>
            <div class="form-toggle">
                <button id="showLogin" class="active">Login</button>
                <button id="showRegister">Register</button>
            </div>

            <!-- LOGIN FORM -->
            <form id="loginForm" class="auth-form">
                <h2>Login</h2>
                <label for="loginEmail" class="auth-label">Email</label>
                <input type="email" id="loginEmail" class="auth-input" placeholder="Enter your email" required>

                <label for="loginPassword" class="auth-label">Password</label>
                <input type="password" id="loginPassword" class="auth-input" placeholder="Enter your password" required>

                <button type="submit" class="auth-btn">Login</button>
                <button type="button" id="forgotPasswordBtn" class="forgot-btn">Forgot Password?</button>
            </form>

            <!-- REGISTER FORM -->
            <form id="registerForm" class="auth-form hidden">
                <h2>Register</h2>
                <label for="registerFullName" class="auth-label">Full Name</label>
                <input type="text" id="registerFullName" class="auth-input" placeholder="Full Name" required>

                <label for="registerEmail" class="auth-label">Email</label>
                <input type="email" id="registerEmail" class="auth-input" placeholder="Email" required>

                <label class="auth-label">User Type</label>
                <select id="userType" class="auth-select" required>
                    <option value="">Select Type</option>
                    <option value="student">Student</option>
                    <option value="lecturer">Lecturer</option>
                </select>

                <div id="studentFields" class="user-specific hidden">
                    <label for="registerStudentNumber" class="auth-label">Student Number</label>
                    <input type="text" id="registerStudentNumber" class="auth-input" placeholder="Student Number">
                </div>

                <div id="lecturerFields" class="user-specific hidden">
                    <label for="registerLecturerID" class="auth-label">Lecturer ID</label>
                    <input type="text" id="registerLecturerID" class="auth-input" placeholder="Lecturer ID">
                </div>

                <label for="registerDeviceID" class="auth-label">Device ID</label>
                <input type="text" id="registerDeviceID" class="auth-input" placeholder="Device ID" required>

                <label for="registerPassword" class="auth-label">Password</label>
                <input type="password" id="registerPassword" class="auth-input" placeholder="Password" required>

                <label for="registerConfirmPassword" class="auth-label">Confirm Password</label>
                <input type="password" id="registerConfirmPassword" class="auth-input" placeholder="Confirm Password" required>

                <button type="submit" class="auth-btn">Register</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainPage">
        <div class="container" id="mainApp">
            <!-- Admin Panel (only visible to lecturers) -->
            <div class="admin-panel" id="adminPanel">
                <h2 class="panel-title"><i class="fas fa-user-shield"></i> Admin Panel</h2>

                <div class="admin-controls">
                    <button class="btn btn-primary" id="showNotificationForm">
                        <i class="fas fa-bullhorn"></i> Add Notification
                    </button>
                    <button class="btn btn-warning" id="showUpdateForm">
                        <i class="fas fa-sync-alt"></i> Post Update
                    </button>
                    <button class="btn btn-success" id="showNotificationsList">
                        <i class="fas fa-list"></i> View All Notifications
                    </button>
                </div>

                <!-- Add Notification Form -->
                <div class="admin-form" id="notificationForm">
                    <h3 class="panel-title"><i class="fas fa-bullhorn"></i> Add Notification</h3>
                    <div class="form-group">
                        <label for="notificationTitle">Title</label>
                        <input type="text" id="notificationTitle" placeholder="Enter notification title">
                    </div>
                    <div class="form-group">
                        <label for="notificationContent">Content</label>
                        <textarea id="notificationContent" placeholder="Enter notification content"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="notificationPriority">Priority</label>
                        <select id="notificationPriority">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="submitNotification">
                        <i class="fas fa-paper-plane"></i> Publish Notification
                    </button>
                </div>

                <!-- Post Update Form -->
                <div class="admin-form" id="updateForm">
                    <h3 class="panel-title"><i class="fas fa-sync-alt"></i> Post Update</h3>
                    <div class="form-group">
                        <label for="updateTitle">Update Title</label>
                        <input type="text" id="updateTitle" placeholder="Enter update title">
                    </div>
                    <div class="form-group">
                        <label for="updateContent">Update Details</label>
                        <textarea id="updateContent" placeholder="Enter update details"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="updateType">Update Type</label>
                        <select id="updateType">
                            <option value="system">System Update</option>
                            <option value="feature">New Feature</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="event">Event</option>
                        </select>
                    </div>
                    <button class="btn btn-warning" id="submitUpdate">
                        <i class="fas fa-upload"></i> Post Update
                    </button>
                </div>

                <!-- Notifications List -->
                <div class="admin-form" id="notificationsList">
                    <h3 class="panel-title"><i class="fas fa-list"></i> All Notifications & Updates</h3>
                    <div class="notifications-list" id="notificationsContainer">
                        <!-- Notifications will be populated here -->
                    </div>
                </div>
            </div>

            <header>
                <div>
                    <h1><i class="fas fa-map-marker-alt"></i> Campus Find</h1>
                    <p class="subtitle">Offline Peer-to-Peer Location Tracker</p>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <div>
                        <div id="userDisplayName">John Doe</div>
                        <div id="userDisplayType" style="font-size: 0.8rem; opacity: 0.8;">Student</div>
                    </div>
                </div>
            </header>

            <div class="main-content">
                <div class="map-container">
                    <h2 class="panel-title"><i class="fas fa-map"></i> Campus Map</h2>

                    <div class="floor-selector">
                        <button class="floor-btn active" data-floor="0">Ground Floor</button>
                        <button class="floor-btn" data-floor="1">First Floor</button>
                        <button class="floor-btn" data-floor="2">Second Floor</button>
                        <button class="floor-btn" data-floor="3">Third Floor</button>
                        <button class="floor-btn" data-floor="4">Fourth Floor</button>
                    </div>

                    <div class="campus-map" id="campusMap">
                        <!-- Devices will be positioned here by JavaScript -->
                    </div>

                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #882ab7;"></div>
                            <span>You</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #5d4bce;"></div>
                            <span>Lectures</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #6c0404;"></div>
                            <span>Students</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f1c40f;"></div>
                            <span>Staff</span>
                        </div>
                    </div>
                </div>

                <div class="controls-panel">
                    <div class="panel">
                        <h2 class="panel-title"><i class="fas fa-users"></i> Nearby Devices</h2>
                        <ul class="device-list" id="deviceList">
                            <!-- Device list will be populated by JavaScript -->
                        </ul>
                    </div>

                    <div class="panel">
                        <h2 class="panel-title"><i class="fas fa-wifi"></i> P2P Connection</h2>
                        <div class="connection-status">
                            <p>Status: <span id="connectionStatus">Connected to 0 devices</span></p>
                            <p>Range: <span id="connectionRange">Approx. 0 meters</span></p>
                        </div>
                    </div>

                    <div class="panel">
                        <h2 class="panel-title"><i class="fas fa-search-location"></i> Find Places</h2>
                        <div class="search-places">
                            <input type="text" id="searchInput" placeholder="Search for rooms, people..." style="width: 100%; padding: 10px; border-radius: 8px; border: none; background: rgba(255, 255, 255, 0.1); color: white;">
                            <div class="search-buttons">
                                <button class="search-btn" id="searchLectureroom"><i class="fas fa-chalkboard-teacher"></i> Lectureroom</button>
                                <button class="search-btn" id="searchKitchen"><i class="fas fa-utensils"></i> Kitchen</button>
                                <button class="search-btn" id="searchOffice"><i class="fas fa-building"></i> Office</button>
                                <button class="search-btn" id="searchChillArea"><i class="fas fa-couch"></i> Chill Area</button>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Display for All Users -->
                    <div class="panel">
                        <h2 class="panel-title"><i class="fas fa-bullhorn"></i> Campus Notifications</h2>
                        <div class="notifications-list" id="publicNotifications">
                            <!-- Public notifications will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn" id="simulateBtn"><i class="fas fa-plus"></i> Simulate Device</button>
                <button class="btn btn-primary" id="startScanBtn"><i class="fas fa-search"></i> Start Scanning</button>
                <button class="btn btn-danger" id="stopScanBtn"><i class="fas fa-stop"></i> Stop Scanning</button>
                <button class="btn" id="settingsBtn"><i class="fas fa-cog"></i> Settings</button>
                <button class="btn btn-warning" id="adminBtn" style="display: none;"><i class="fas fa-user-shield"></i> Admin Panel</button>
                <button class="btn btn-success" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Log Out</button>
            </div>

            <div class="status-bar">
                <span class="signal-strength signal-excellent"></span>
                <span id="statusText">Ready to scan for nearby devices</span>
            </div>
        </div>

        <!-- Logout Page -->
        <div class="container logout-container" id="logoutPage">
            <div class="logout-card">
                <i class="fas fa-sign-out-alt logout-icon"></i>
                <h2 class="logout-title">Log Out</h2>
                <p class="logout-message">Are you sure you want to log out of Campus Find? You'll need to sign in again to access the campus tracking features.</p>
                <div class="logout-actions">
                    <button class="btn btn-danger" id="confirmLogoutBtn">
                        <i class="fas fa-check"></i> Yes, Log Out
                    </button>
                    <button class="btn btn-primary" id="cancelLogoutBtn">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Contact Options Modal -->
        <div class="contact-options" id="contactOptions">
            <div class="contact-header">
                <i class="fas fa-user-circle"></i>
                <div class="contact-name" id="contactName">Contact Name</div>
            </div>
            <button class="contact-btn" id="callBtn">
                <i class="fas fa-phone"></i>
                <span>Call</span>
            </button>
            <button class="contact-btn" id="messageBtn">
                <i class="fas fa-comment"></i>
                <span>Message</span>
            </button>
            <button class="contact-btn" id="viewProfileBtn">
                <i class="fas fa-id-card"></i>
                <span>View Profile</span>
            </button>
            <button class="contact-btn" id="closeContactBtn">
                <i class="fas fa-times"></i>
                <span>Close</span>
            </button>
        </div>
    </div>

    <script>
        // Database Simulation using localStorage
        const DB_NAME = 'campusFindDB';
        const USERS_KEY = 'users';
        const CURRENT_USER_KEY = 'currentUser';
        const NOTIFICATIONS_KEY = 'notifications';

        // Initialize database if it doesn't exist
        function initializeDatabase() {
            if (!localStorage.getItem(DB_NAME)) {
                const db = {
                    [USERS_KEY]: [],
                    [NOTIFICATIONS_KEY]: [],
                    devices: []
                };
                localStorage.setItem(DB_NAME, JSON.stringify(db));
            }
        }

        // Get database
        function getDatabase() {
            return JSON.parse(localStorage.getItem(DB_NAME));
        }

        // Update database
        function updateDatabase(updatedDB) {
            localStorage.setItem(DB_NAME, JSON.stringify(updatedDB));
        }

        // Get users
        function getUsers() {
            const db = getDatabase();
            return db[USERS_KEY];
        }

        // Add user
        function addUser(user) {
            const db = getDatabase();
            db[USERS_KEY].push(user);
            updateDatabase(db);
        }

        // Find user by email
        function findUserByEmail(email) {
            const users = getUsers();
            return users.find(user => user.email === email);
        }

        // Set current user
        function setCurrentUser(user) {
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(user));
        }

        // Get current user
        function getCurrentUser() {
            const user = localStorage.getItem(CURRENT_USER_KEY);
            return user ? JSON.parse(user) : null;
        }

        // Clear current user
        function clearCurrentUser() {
            localStorage.removeItem(CURRENT_USER_KEY);
        }

        // Get notifications
        function getNotifications() {
            const db = getDatabase();
            return db[NOTIFICATIONS_KEY];
        }

        // Add notification
        function addNotification(notification) {
            const db = getDatabase();
            db[NOTIFICATIONS_KEY].push(notification);
            updateDatabase(db);
        }

        // Delete notification
        function deleteNotification(id) {
            const db = getDatabase();
            db[NOTIFICATIONS_KEY] = db[NOTIFICATIONS_KEY].filter(notification => notification.id !== id);
            updateDatabase(db);
        }

        // Initialize the database when the page loads
        initializeDatabase();

        // Check if user is already logged in
        function checkLoginStatus() {
            const currentUser = getCurrentUser();
            if (currentUser) {
                showMainPage(currentUser);
            }
        }

        // Show main page
        function showMainPage(user) {
            document.getElementById('authPage').style.display = 'none';
            document.getElementById('mainPage').style.display = 'block';

            // Update user info in the header
            document.getElementById('userDisplayName').textContent = user.name;
            document.getElementById('userDisplayType').textContent = user.userType.charAt(0).toUpperCase() + user.userType.slice(1);
            document.getElementById('userAvatar').textContent = user.name.split(' ').map(n => n[0]).join('').toUpperCase();

            // Show admin panel and button if user is a lecturer
            if (user.userType === 'lecturer') {
                document.getElementById('adminBtn').style.display = 'flex';
            }

            // Initialize the main application
            initializeMainApp();
        }

        // Show login page
        function showLoginPage() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('authPage').style.display = 'flex';
            clearCurrentUser();
        }

        // Authentication Page Logic
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            checkLoginStatus();

            // Toggle between login and register
            const loginForm = document.getElementById("loginForm");
            const registerForm = document.getElementById("registerForm");
            const showLogin = document.getElementById("showLogin");
            const showRegister = document.getElementById("showRegister");

            showLogin.addEventListener("click", () => {
                loginForm.classList.remove("hidden");
                registerForm.classList.add("hidden");
                showLogin.classList.add("active");
                showRegister.classList.remove("active");
            });

            showRegister.addEventListener("click", () => {
                registerForm.classList.remove("hidden");
                loginForm.classList.add("hidden");
                showRegister.classList.add("active");
                showLogin.classList.remove("active");
            });

            // User type fields toggle
            const userType = document.getElementById("userType");
            const studentFields = document.getElementById("studentFields");
            const lecturerFields = document.getElementById("lecturerFields");

            userType.addEventListener("change", () => {
                if (userType.value === "student") {
                    studentFields.classList.remove("hidden");
                    lecturerFields.classList.add("hidden");
                } else if (userType.value === "lecturer") {
                    lecturerFields.classList.remove("hidden");
                    studentFields.classList.add("hidden");
                } else {
                    studentFields.classList.add("hidden");
                    lecturerFields.classList.add("hidden");
                }
            });

            // Forgot Password
            const forgotPasswordBtn = document.getElementById("forgotPasswordBtn");
            forgotPasswordBtn.addEventListener("click", () => {
                alert("Forgot password? Please contact support or check your email for reset instructions.");
            });

            // Register
            registerForm.addEventListener("submit", (e) => {
                e.preventDefault();

                const name = document.getElementById("registerFullName").value;
                const email = document.getElementById("registerEmail").value;
                const password = document.getElementById("registerPassword").value;
                const confirmPassword = document.getElementById("registerConfirmPassword").value;
                const studentNumber = document.getElementById("registerStudentNumber").value;
                const lecturerId = document.getElementById("registerLecturerID").value;
                const deviceId = document.getElementById("registerDeviceID").value;
                const userTypeValue = document.getElementById("userType").value;

                if (password !== confirmPassword) {
                    alert("Passwords do not match!");
                    return;
                }

                // Check if user already exists
                if (findUserByEmail(email)) {
                    alert("User with this email already exists!");
                    return;
                }

                // Create user object
                const user = {
                    id: Date.now().toString(),
                    name,
                    email,
                    password, // In a real app, this should be hashed
                    userType: userTypeValue,
                    studentNumber: userTypeValue === "student" ? studentNumber : null,
                    lecturerId: userTypeValue === "lecturer" ? lecturerId : null,
                    deviceId,
                    createdAt: new Date().toISOString()
                };

                // Add user to database
                addUser(user);
                alert("Registration successful! Please log in.");

                // Switch to login form
                showLogin.click();
            });

            // Login
            loginForm.addEventListener("submit", (e) => {
                e.preventDefault();

                const email = document.getElementById("loginEmail").value;
                const password = document.getElementById("loginPassword").value;

                // Find user by email
                const user = findUserByEmail(email);

                if (user && user.password === password) {
                    // Set current user
                    setCurrentUser(user);
                    // Show main page
                    showMainPage(user);
                    alert("Login successful!");
                } else {
                    alert("Invalid login credentials.");
                }
            });
        });

        // Main Application Logic
        function initializeMainApp() {
            // Database of devices
            const deviceDatabase = [
                { id: 'DEV-001', name: 'You', type: 'self', floor: 0, x: 0.5, y: 0.5, distance: '0 m', phone: '', email: '' },
                { id: 'DEV-002', name: 'Prof. Johnson', type: 'lectures', floor: 0, x: 0.3, y: 0.3, distance: '25 m', phone: '+1-555-0101', email: 'johnson@campus.edu' },
                { id: 'DEV-003', name: 'Sarah M.', type: 'students', floor: 0, x: 0.7, y: 0.7, distance: '18 m', phone: '+1-555-0102', email: 'sarah.m@student.edu' },
                { id: 'DEV-004', name: 'Cafeteria', type: 'place', floor: 0, x: 0.2, y: 0.8, distance: '42 m', phone: '+1-555-0103', email: '' },
                { id: 'DEV-005', name: 'Library', type: 'place', floor: 1, x: 0.6, y: 0.4, distance: '65 m', phone: '+1-555-0104', email: '' },
                { id: 'DEV-006', name: 'IT Support', type: 'staff', floor: 2, x: 0.5, y: 0.6, distance: '78 m', phone: '+1-555-0105', email: 'itsupport@campus.edu' },
                { id: 'DEV-007', name: 'Mike T.', type: 'students', floor: 1, x: 0.4, y: 0.2, distance: '55 m', phone: '+1-555-0106', email: 'mike.t@student.edu' },
                { id: 'DEV-008', name: 'Lab 3B', type: 'place', floor: 3, x: 0.7, y: 0.5, distance: '92 m', phone: '', email: '' },
                { id: 'DEV-009', name: 'Admin Office', type: 'place', floor: 0, x: 0.8, y: 0.2, distance: '35 m', phone: '+1-555-0107', email: 'admin@campus.edu' },
                { id: 'DEV-010', name: 'Student Lounge', type: 'place', floor: 1, x: 0.3, y: 0.7, distance: '58 m', phone: '', email: '' }
            ];

            // DOM Elements
            const mainApp = document.getElementById('mainApp');
            const logoutPage = document.getElementById('logoutPage');
            const campusMap = document.getElementById('campusMap');
            const deviceList = document.getElementById('deviceList');
            const statusText = document.getElementById('statusText');
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionRange = document.getElementById('connectionRange');
            const simulateBtn = document.getElementById('simulateBtn');
            const startScanBtn = document.getElementById('startScanBtn');
            const stopScanBtn = document.getElementById('stopScanBtn');
            const settingsBtn = document.getElementById('settingsBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const adminBtn = document.getElementById('adminBtn');
            const adminPanel = document.getElementById('adminPanel');
            const confirmLogoutBtn = document.getElementById('confirmLogoutBtn');
            const cancelLogoutBtn = document.getElementById('cancelLogoutBtn');
            const floorButtons = document.querySelectorAll('.floor-btn');
            const searchInput = document.getElementById('searchInput');
            const searchLectureroom = document.getElementById('searchLectureroom');
            const searchKitchen = document.getElementById('searchKitchen');
            const searchOffice = document.getElementById('searchOffice');
            const searchChillArea = document.getElementById('searchChillArea');
            const contactOptions = document.getElementById('contactOptions');
            const contactName = document.getElementById('contactName');
            const callBtn = document.getElementById('callBtn');
            const messageBtn = document.getElementById('messageBtn');
            const viewProfileBtn = document.getElementById('viewProfileBtn');
            const closeContactBtn = document.getElementById('closeContactBtn');

            // Admin elements
            const showNotificationForm = document.getElementById('showNotificationForm');
            const showUpdateForm = document.getElementById('showUpdateForm');
            const showNotificationsList = document.getElementById('showNotificationsList');
            const notificationForm = document.getElementById('notificationForm');
            const updateForm = document.getElementById('updateForm');
            const notificationsList = document.getElementById('notificationsList');
            const submitNotification = document.getElementById('submitNotification');
            const submitUpdate = document.getElementById('submitUpdate');
            const notificationsContainer = document.getElementById('notificationsContainer');
            const publicNotifications = document.getElementById('publicNotifications');

            let devices = [...deviceDatabase];
            let currentFloor = 0;
            let scanInterval = null;
            let isScanning = false;
            let selectedDevice = null;

            // Device type colors
            const deviceColors = {
                'self': '#882ab7',
                'students': '#6c0404',
                'lectures': '#5d4bce',
                'staff': '#f1c40f',
                'place': '#9b59b6'
            };

            // Device type icons
            const deviceIcons = {
                'self': 'user',
                'students': 'user-graduate',
                'lectures': 'chalkboard-teacher',
                'staff': 'user-tie',
                'place': 'map-marker-alt'
            };

            // Create visual representation of devices on the map
            function renderDevices() {
                // Clear the map
                campusMap.innerHTML = '';

                // Create and position device elements for current floor
                devices.filter(device => device.floor === currentFloor).forEach(device => {
                    const deviceEl = document.createElement('div');
                    deviceEl.className = 'device';
                    deviceEl.setAttribute('data-name', device.name);
                    deviceEl.setAttribute('data-id', device.id);
                    deviceEl.style.backgroundColor = deviceColors[device.type];
                    deviceEl.style.left = `${device.x * 100}%`;
                    deviceEl.style.top = `${device.y * 100}%`;

                    // Add icon to device
                    const icon = document.createElement('i');
                    icon.className = `fas fa-${deviceIcons[device.type]}`;
                    deviceEl.appendChild(icon);

                    // Add click event to show contact options
                    deviceEl.addEventListener('click', (e) => {
                        e.stopPropagation();
                        showContactOptions(device, e.clientX, e.clientY);
                    });

                    campusMap.appendChild(deviceEl);
                });

                // Update device list
                deviceList.innerHTML = '';
                devices.filter(device => device.floor === currentFloor).forEach(device => {
                    const listItem = document.createElement('li');
                    listItem.className = 'device-item';
                    listItem.setAttribute('data-id', device.id);

                    listItem.innerHTML = `
                        <div class="device-info">
                            <div class="device-name">${device.name}</div>
                            <div class="device-floor">Floor ${getFloorName(device.floor)}</div>
                        </div>
                        <div class="device-distance">${device.distance}</div>
                    `;

                    // Add click event to device list item
                    listItem.addEventListener('click', () => {
                        showContactOptions(device, listItem.getBoundingClientRect().right, listItem.getBoundingClientRect().top);

                        // Highlight selected device
                        document.querySelectorAll('.device-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        listItem.classList.add('active');
                    });

                    deviceList.appendChild(listItem);
                });
            }

            // Get floor name from number
            function getFloorName(floorNum) {
                const floors = ['Ground', 'First', 'Second', 'Third', 'Fourth'];
                return floors[floorNum] || floorNum;
            }

            // Simulate device movement
            function moveDevices() {
                devices.forEach(device => {
                    if (device.id !== 'DEV-001' && device.type !== 'place') {
                        // Random floor change with 5% probability
                        if (Math.random() < 0.05) {
                            device.floor = Math.floor(Math.random() * 5);
                        }

                        // Random slight movement
                        device.x = Math.max(0.1, Math.min(0.9, device.x + (Math.random() - 0.5) * 0.05));
                        device.y = Math.max(0.1, Math.min(0.9, device.y + (Math.random() - 0.5) * 0.05));

                        // Calculate distance from our device (simplified)
                        const ourDevice = devices.find(d => d.id === 'DEV-001');
                        const distance = Math.sqrt(
                            Math.pow(ourDevice.x - device.x, 2) +
                            Math.pow(ourDevice.y - device.y, 2)
                        ) * 1000;

                        device.distance = `${Math.round(distance)} m`;
                    }
                });

                renderDevices();
                updateConnectionStatus();
            }

            // Update connection status
            function updateConnectionStatus() {
                const nearbyDevices = devices.filter(d => d.id !== 'DEV-001' && d.floor === currentFloor).length;
                connectionStatus.textContent = `Connected to ${nearbyDevices} devices`;

                // Simulate range change
                const range = Math.floor(Math.random() * 50) + 10;
                connectionRange.textContent = `Approx. ${range} meters`;

                // Update signal strength indicator
                const signalStrength = document.querySelector('.signal-strength');
                if (range < 20) {
                    signalStrength.className = 'signal-strength signal-excellent';
                } else if (range < 35) {
                    signalStrength.className = 'signal-strength signal-good';
                } else {
                    signalStrength.className = 'signal-strength signal-weak';
                }
            }

            // Start scanning for devices
            function startScanning() {
                if (isScanning) return;

                isScanning = true;
                statusText.textContent = 'Scanning for nearby devices...';
                startScanBtn.disabled = true;
                stopScanBtn.disabled = false;

                // Simulate finding devices
                let foundCount = 0;
                scanInterval = setInterval(() => {
                    if (foundCount < deviceDatabase.length - 1) {
                        // Add a device from database
                        const newDevice = deviceDatabase[foundCount + 1];
                        if (!devices.some(d => d.id === newDevice.id)) {
                            devices.push(newDevice);
                            renderDevices();
                            updateConnectionStatus();
                        }
                        foundCount++;
                    } else {
                        clearInterval(scanInterval);
                        statusText.textContent = 'Scan complete. Found ' + foundCount + ' devices.';
                        isScanning = false;
                        startScanBtn.disabled = false;
                    }
                }, 1000);
            }

            // Stop scanning
            function stopScanning() {
                if (scanInterval) {
                    clearInterval(scanInterval);
                    scanInterval = null;
                }
                isScanning = false;
                statusText.textContent = 'Scanning stopped.';
                startScanBtn.disabled = false;
                stopScanBtn.disabled = true;
            }

            // Simulate adding a new device
            function simulateDevice() {
                const deviceTypes = ['students', 'lectures', 'staff', 'place'];
                const randomType = deviceTypes[Math.floor(Math.random() * deviceTypes.length)];
                const randomFloor = Math.floor(Math.random() * 5);
                const randomX = Math.random() * 0.8 + 0.1;
                const randomY = Math.random() * 0.8 + 0.1;

                const newDevice = {
                    id: 'DEV-' + (devices.length + 1).toString().padStart(3, '0'),
                    name: randomType === 'students' ? 'Student ' + (Math.floor(Math.random() * 100) + 1) :
                          randomType === 'lectures' ? 'Prof. ' + String.fromCharCode(65 + Math.floor(Math.random() * 26)) :
                          randomType === 'staff' ? 'Staff Member' :
                          randomType === 'place' ? (Math.random() > 0.5 ? 'Office' : 'Chill Area') : 'Location',
                    type: randomType,
                    floor: randomFloor,
                    x: randomX,
                    y: randomY,
                    distance: Math.floor(Math.random() * 100) + ' m',
                    phone: randomType !== 'place' ? '+1-555-' + (1000 + Math.floor(Math.random() * 9000)) : '',
                    email: randomType !== 'place' ? 'user' + (devices.length + 1) + '@campus.edu' : ''
                };

                devices.push(newDevice);
                renderDevices();
                updateConnectionStatus();

                statusText.textContent = `Simulated device added: ${newDevice.name}`;

                // Auto-clear the message after 3 seconds
                setTimeout(() => {
                    if (statusText.textContent.includes('Simulated device added')) {
                        statusText.textContent = isScanning ? 'Scanning for nearby devices...' : 'Ready to scan for nearby devices';
                    }
                }, 3000);
            }

            // Search for devices
            function searchDevices(query) {
                if (!query) return;

                const results = devices.filter(device =>
                    device.name.toLowerCase().includes(query.toLowerCase()) &&
                    device.id !== 'DEV-001'
                );

                if (results.length > 0) {
                    // Switch to the floor of the first result
                    currentFloor = results[0].floor;
                    updateFloorButtons();
                    renderDevices();

                    // Highlight the found devices
                    results.forEach(device => {
                        const deviceEl = document.querySelector(`.device[data-id="${device.id}"]`);
                        if (deviceEl) {
                            deviceEl.style.boxShadow = '0 0 15px 5px #ffdd00';
                            deviceEl.style.zIndex = '10';
                            deviceEl.style.animation = 'pulse 1.5s infinite';
                        }

                        const listItem = document.querySelector(`.device-item[data-id="${device.id}"]`);
                        if (listItem) {
                            listItem.style.background = 'rgba(255, 221, 0, 0.3)';
                        }
                    });

                    statusText.textContent = `Found ${results.length} result(s) for "${query}"`;

                    // Remove highlighting after 5 seconds
                    setTimeout(() => {
                        results.forEach(device => {
                            const deviceEl = document.querySelector(`.device[data-id="${device.id}"]`);
                            if (deviceEl) {
                                deviceEl.style.boxShadow = '';
                                deviceEl.style.zIndex = '';
                                deviceEl.style.animation = '';
                            }

                            const listItem = document.querySelector(`.device-item[data-id="${device.id}"]`);
                            if (listItem) {
                                listItem.style.background = '';
                            }
                        });

                        if (statusText.textContent.includes(`Found ${results.length} result(s)`)) {
                            statusText.textContent = isScanning ? 'Scanning for nearby devices...' : 'Ready to scan for nearby devices';
                        }
                    }, 5000);
                } else {
                    statusText.textContent = `No results found for "${query}"`;

                    // Auto-clear the message after 3 seconds
                    setTimeout(() => {
                        if (statusText.textContent.includes('No results found')) {
                            statusText.textContent = isScanning ? 'Scanning for nearby devices...' : 'Ready to scan for nearby devices';
                        }
                    }, 3000);
                }
            }

            // Update floor buttons active state
            function updateFloorButtons() {
                floorButtons.forEach(btn => {
                    if (parseInt(btn.getAttribute('data-floor')) === currentFloor) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            // Show contact options for a device
            function showContactOptions(device, x, y) {
                selectedDevice = device;
                contactName.textContent = device.name;

                // Position the contact options
                contactOptions.style.left = `${x}px`;
                contactOptions.style.top = `${y}px`;

                // Show the contact options
                contactOptions.classList.add('active');

                // Update button states based on device type
                if (device.type === 'place') {
                    callBtn.style.display = 'none';
                    messageBtn.style.display = 'none';
                    viewProfileBtn.textContent = 'View Details';
                } else {
                    callBtn.style.display = 'flex';
                    messageBtn.style.display = 'flex';
                    viewProfileBtn.textContent = 'View Profile';
                }
            }

            // Hide contact options
            function hideContactOptions() {
                contactOptions.classList.remove('active');
                document.querySelectorAll('.device-item').forEach(item => {
                    item.classList.remove('active');
                });
            }

            // Show logout page
            function showLogoutPage() {
                mainApp.style.display = 'none';
                logoutPage.style.display = 'flex';
            }

            // Show main app
            function showMainApp() {
                logoutPage.style.display = 'none';
                mainApp.style.display = 'block';
            }

            // Admin Panel Functions
            function toggleAdminPanel() {
                adminPanel.classList.toggle('active');
            }

            function showAdminForm(formToShow) {
                // Hide all forms
                notificationForm.style.display = 'none';
                updateForm.style.display = 'none';
                notificationsList.style.display = 'none';

                // Show the selected form
                formToShow.style.display = 'block';
            }

            function loadNotifications() {
                const notifications = getNotifications();
                notificationsContainer.innerHTML = '';
                publicNotifications.innerHTML = '';

                if (notifications.length === 0) {
                    notificationsContainer.innerHTML = '<p>No notifications yet.</p>';
                    publicNotifications.innerHTML = '<p>No notifications at this time.</p>';
                    return;
                }

                // Sort notifications by date (newest first)
                notifications.sort((a, b) => new Date(b.date) - new Date(a.date));

                // Display in admin panel
                notifications.forEach(notification => {
                    const notificationItem = document.createElement('div');
                    notificationItem.className = 'notification-item';
                    notificationItem.innerHTML = `
                        <div class="notification-header">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-date">${new Date(notification.date).toLocaleString()}</div>
                        </div>
                        <div class="notification-content">${notification.content}</div>
                        <div class="notification-meta">
                            <strong>Type:</strong> ${notification.type} |
                            <strong>Priority:</strong> ${notification.priority}
                        </div>
                        <div class="notification-actions">
                            <button class="btn btn-danger delete-notification" data-id="${notification.id}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    `;
                    notificationsContainer.appendChild(notificationItem);
                });

                // Display latest 3 notifications in public panel
                const latestNotifications = notifications.slice(0, 3);
                latestNotifications.forEach(notification => {
                    const notificationItem = document.createElement('div');
                    notificationItem.className = 'notification-item';
                    notificationItem.innerHTML = `
                        <div class="notification-header">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-date">${new Date(notification.date).toLocaleString()}</div>
                        </div>
                        <div class="notification-content">${notification.content}</div>
                        <div class="notification-meta">
                            <strong>Type:</strong> ${notification.type} |
                            <strong>Priority:</strong> ${notification.priority}
                        </div>
                    `;
                    publicNotifications.appendChild(notificationItem);
                });

                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-notification').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        deleteNotification(id);
                        loadNotifications();
                        alert('Notification deleted successfully!');
                    });
                });
            }

            function addNewNotification() {
                const title = document.getElementById('notificationTitle').value;
                const content = document.getElementById('notificationContent').value;
                const priority = document.getElementById('notificationPriority').value;

                if (!title || !content) {
                    alert('Please fill in all fields');
                    return;
                }

                const notification = {
                    id: Date.now().toString(),
                    title,
                    content,
                    priority,
                    type: 'notification',
                    date: new Date().toISOString(),
                    author: getCurrentUser().name
                };

                addNotification(notification);
                document.getElementById('notificationTitle').value = '';
                document.getElementById('notificationContent').value = '';
                document.getElementById('notificationPriority').value = 'low';

                loadNotifications();
                alert('Notification published successfully!');
            }

            function addNewUpdate() {
                const title = document.getElementById('updateTitle').value;
                const content = document.getElementById('updateContent').value;
                const type = document.getElementById('updateType').value;

                if (!title || !content) {
                    alert('Please fill in all fields');
                    return;
                }

                const notification = {
                    id: Date.now().toString(),
                    title,
                    content,
                    priority: 'medium',
                    type,
                    date: new Date().toISOString(),
                    author: getCurrentUser().name
                };

                addNotification(notification);
                document.getElementById('updateTitle').value = '';
                document.getElementById('updateContent').value = '';
                document.getElementById('updateType').value = 'system';

                loadNotifications();
                alert('Update posted successfully!');
            }

            // Event listeners
            simulateBtn.addEventListener('click', simulateDevice);

            startScanBtn.addEventListener('click', startScanning);

            stopScanBtn.addEventListener('click', stopScanning);

            settingsBtn.addEventListener('click', () => {
                statusText.textContent = 'Settings panel would open here';

                // Auto-clear the message after 3 seconds
                setTimeout(() => {
                    if (statusText.textContent.includes('Settings panel')) {
                        statusText.textContent = isScanning ? 'Scanning for nearby devices...' : 'Ready to scan for nearby devices';
                    }
                }, 3000);
            });

            logoutBtn.addEventListener('click', showLogoutPage);

            adminBtn.addEventListener('click', toggleAdminPanel);

            // Admin event listeners
            showNotificationForm.addEventListener('click', () => showAdminForm(notificationForm));
            showUpdateForm.addEventListener('click', () => showAdminForm(updateForm));
            showNotificationsList.addEventListener('click', () => {
                showAdminForm(notificationsList);
                loadNotifications();
            });

            submitNotification.addEventListener('click', addNewNotification);
            submitUpdate.addEventListener('click', addNewUpdate);

            confirmLogoutBtn.addEventListener('click', () => {
                showLoginPage();
            });

            cancelLogoutBtn.addEventListener('click', showMainApp);

            floorButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentFloor = parseInt(btn.getAttribute('data-floor'));
                    updateFloorButtons();
                    renderDevices();
                    updateConnectionStatus();
                });
            });

            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchDevices(searchInput.value);
                }
            });

            searchLectureroom.addEventListener('click', () => {
                searchInput.value = 'lectureroom';
                searchDevices('lectureroom');
            });

            searchKitchen.addEventListener('click', () => {
                searchInput.value = 'kitchen';
                searchDevices('kitchen');
            });

            searchOffice.addEventListener('click', () => {
                searchInput.value = 'office';
                searchDevices('office');
            });

            searchChillArea.addEventListener('click', () => {
                searchInput.value = 'chill area';
                searchDevices('chill area');
            });

            // Contact options event listeners
            callBtn.addEventListener('click', () => {
                if (selectedDevice && selectedDevice.phone) {
                    alert(`Calling ${selectedDevice.name} at ${selectedDevice.phone}`);
                } else {
                    alert(`No phone number available for ${selectedDevice.name}`);
                }
                hideContactOptions();
            });

            messageBtn.addEventListener('click', () => {
                if (selectedDevice && (selectedDevice.phone || selectedDevice.email)) {
                    alert(`Opening message interface for ${selectedDevice.name}`);
                } else {
                    alert(`No contact information available for ${selectedDevice.name}`);
                }
                hideContactOptions();
            });

            viewProfileBtn.addEventListener('click', () => {
                if (selectedDevice) {
                    if (selectedDevice.type === 'place') {
                        alert(`Showing details for ${selectedDevice.name}`);
                    } else {
                        alert(`Showing profile for ${selectedDevice.name}`);
                    }
                }
                hideContactOptions();
            });

            closeContactBtn.addEventListener('click', hideContactOptions);

            // Close contact options when clicking outside
            document.addEventListener('click', (e) => {
                if (!contactOptions.contains(e.target)) {
                    hideContactOptions();
                }
            });

            // Add CSS for pulse animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { transform: translate(-50%, -50%) scale(1); }
                    50% { transform: translate(-50%, -50%) scale(1.2); }
                    100% { transform: translate(-50%, -50%) scale(1); }
                }
            `;
            document.head.appendChild(style);

            // Initialize the app
            renderDevices();
            updateConnectionStatus();
            stopScanBtn.disabled = true;

            // Load notifications
            loadNotifications();
        }
    </script>
</body>
</html>